{% extends 'store/base.html' %}
{% load static %}

{% block title %}Order #{{ order.order_number }} - FlugEde{% endblock %}

{% block content %}
<div class="container" style="margin: 4rem auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1><i class="fas fa-box"></i> Order #{{ order.order_number }}</h1>
        <span class="badge 
            {% if order.order_status == 'delivered' %}badge-success
            {% elif order.order_status == 'cancelled' %}badge-error
            {% elif order.order_status == 'shipped' or order.order_status == 'out_for_delivery' %}badge-info
            {% else %}badge-warning{% endif %}" style="font-size: 1rem; padding: 0.5rem 1rem;">
            {{ order.get_order_status_display }}
        </span>
    </div>

    <div class="layout-2-1">
        <!-- Order Details -->
        <div>
            <!-- Order Items -->
            <div class="card" style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Order Items</h3>

                {% for item in order.items.all %}
                <div
                    style="display: grid; grid-template-columns: 100px 1fr auto; gap: 1.5rem; padding-bottom: 1.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color);">
                    {% if item.product and item.product.images.all.0 %}
                    <img src="{{ item.product.images.all.0.image.url }}" alt="{{ item.product_name }}"
                        style="width: 100px; height: 100px; object-fit: cover; border-radius: 0.5rem;">
                    {% else %}
                    <div
                        style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border-radius: 0.5rem; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-image" style="font-size: 2rem; color: white; opacity: 0.3;"></i>
                    </div>
                    {% endif %}

                    <div>
                        <div style="font-weight: 600; font-size: 1.1rem; margin-bottom: 0.5rem;">{{ item.product_name }}
                        </div>
                        <div style="color: var(--text-muted); margin-bottom: 0.5rem;">
                            Quantity: {{ item.quantity }} × ₹{{ item.product_price }}
                        </div>
                        {% if item.warranty_period %}
                        <div style="color: var(--success); font-size: 0.9rem;">
                            <i class="fas fa-shield-alt"></i> {{ item.warranty_period }} Warranty
                        </div>
                        {% endif %}
                    </div>

                    <div style="text-align: right;">
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary-light);">
                            ₹{{ item.total_price }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Delivery Address -->
            <div class="card">
                <h3 style="margin-bottom: 1.5rem;"><i class="fas fa-map-marker-alt"></i> Delivery Address</h3>
                <div style="color: var(--text-secondary);">
                    <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 0.5rem;">
                        {{ order.address.full_name }}
                    </div>
                    {{ order.address.address_line1 }}<br>
                    {% if order.address.address_line2 %}{{ order.address.address_line2 }}<br>{% endif %}
                    {{ order.address.city }}, {{ order.address.state }} - {{ order.address.pincode }}<br>
                    Phone: {{ order.address.phone }}
                </div>
            </div>
        </div>

        <!-- Order Summary -->
        <div>
            <div class="card glass" style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Order Summary</h3>

                <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Subtotal</span>
                        <span>₹{{ order.subtotal }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Shipping</span>
                        <span>₹{{ order.shipping_charge }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Tax</span>
                        <span>₹{{ order.tax }}</span>
                    </div>
                    {% if order.discount > 0 %}
                    <div style="display: flex; justify-content: space-between; color: var(--success);">
                        <span>Discount</span>
                        <span>-₹{{ order.discount }}</span>
                    </div>
                    {% endif %}
                </div>

                <div
                    style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: 700; margin-bottom: 1.5rem;">
                    <span>Total</span>
                    <span style="color: var(--primary-light);">₹{{ order.total }}</span>
                </div>

                <div style="padding-top: 1rem; border-top: 1px solid var(--border-color);">
                    <div style="margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Payment Method:</span>
                        <span style="font-weight: 600;">{{ order.get_payment_method_display }}</span>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <span style="color: var(--text-secondary);">Payment Status:</span>
                        <span
                            class="badge {% if order.payment_status == 'completed' %}badge-success{% elif order.payment_status == 'failed' %}badge-error{% else %}badge-warning{% endif %}">
                            {{ order.get_payment_status_display }}
                        </span>
                    </div>
                    <div>
                        <span style="color: var(--text-secondary);">Order Date:</span>
                        <span style="font-weight: 600;">{{ order.created_at|date:"M d, Y" }}</span>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card">
                <h3 style="margin-bottom: 1rem;">Actions</h3>

                {% if order.order_status == 'pending' or order.order_status == 'confirmed' %}
                <a href="{% url 'cancel_order' order.id %}" class="btn btn-danger"
                    style="width: 100%; justify-content: center; margin-bottom: 0.5rem;"
                    onclick="return confirm('Are you sure you want to cancel this order?')">
                    <i class="fas fa-times"></i> Cancel Order
                </a>
                {% endif %}

                <a href="{% url 'order_list' %}" class="btn btn-outline" style="width: 100%; justify-content: center;">
                    <i class="fas fa-arrow-left"></i> Back to Orders
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}