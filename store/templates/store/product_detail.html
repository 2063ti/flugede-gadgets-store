{% extends 'store/base.html' %} {% load static %} {% block title %}{{
product.name }} - FlugEde{% endblock %} {% block content %}
<div class="container" style="margin: 2rem auto">
  <div
    style="
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
      margin-bottom: 4rem;
    "
  >
    <!-- Product Images -->
    <div>
      <div class="card" style="padding: 0; overflow: hidden">
        {% if product.images.all.0 %}
        <img
          id="mainProductImage"
          src="{{ product.images.all.0.image.url }}"
          alt="{{ product.name }}"
          style="width: 100%; height: 500px; object-fit: cover"
        />
        {% else %}
        <div
          style="
            width: 100%;
            height: 500px;
            background: linear-gradient(
              135deg,
              var(--primary-color),
              var(--secondary-color)
            );
            display: flex;
            align-items: center;
            justify-content: center;
          "
        >
          <i
            class="fas fa-image"
            style="font-size: 5rem; color: white; opacity: 0.3"
          ></i>
        </div>
        {% endif %}
      </div>

      {% if product.images.count > 1 %}
      <div
        style="
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 1rem;
          margin-top: 1rem;
        "
      >
        {% for image in product.images.all %}
        <div
          class="card product-thumbnail {% if forloop.first %}active{% endif %}"
          data-image="{{ image.image.url }}"
          style="
            padding: 0;
            cursor: pointer;
            overflow: hidden;
            border: 2px solid transparent;
            transition: var(--transition);
          "
        >
          <img
            src="{{ image.image.url }}"
            alt="{{ product.name }}"
            style="width: 100%; height: 100px; object-fit: cover"
          />
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Product Info -->
    <div>
      <div style="margin-bottom: 1rem">
        <span class="badge badge-info">{{ product.brand.name }}</span>
        <span
          class="badge {% if product.stock > 10 %}badge-success{% elif product.stock > 0 %}badge-warning{% else %}badge-error{% endif %}"
        >
          {{ product.stock_status }}
        </span>
        {% if product.is_featured %}
        <span class="badge" style="background: var(--warning)">Featured</span>
        {% endif %}
      </div>

      <h1 style="margin-bottom: 1rem">{{ product.name }}</h1>

      <div
        style="
          display: flex;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1.5rem;
        "
      >
        <div style="display: flex; align-items: center; gap: 0.25rem">
          {% for i in "12345" %}
          <i
            class="fas fa-star"
            style="color: {% if avg_rating >= forloop.counter %}var(--warning){% else %}var(--text-muted){% endif %};"
          ></i>
          {% endfor %}
        </div>
        <span style="color: var(--text-secondary)"
          >{{ avg_rating|floatformat:1 }} ({{ reviews.count }} reviews)</span
        >
      </div>

      <div style="margin-bottom: 2rem">
        <div
          style="
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-light);
            margin-bottom: 0.5rem;
          "
        >
          ₹{{ product.final_price }} {% if product.discount_price %}
          <span
            style="
              font-size: 1.5rem;
              text-decoration: line-through;
              color: var(--text-muted);
              margin-left: 1rem;
            "
          >
            ₹{{ product.price }}
          </span>
          <span
            class="badge badge-success"
            style="font-size: 1rem; margin-left: 0.5rem"
          >
            {{ product.discount_percentage }}% OFF
          </span>
          {% endif %}
        </div>
        <p style="color: var(--text-muted)">Inclusive of all taxes</p>
      </div>

      <div
        style="
          padding: 1.5rem;
          background: rgba(99, 102, 241, 0.1);
          border-radius: 0.75rem;
          border: 1px solid var(--primary-color);
          margin-bottom: 2rem;
        "
      >
        <h4 style="margin-bottom: 1rem">
          <i class="fas fa-info-circle"></i> Product Details
        </h4>
        <p style="color: var(--text-secondary); line-height: 1.8">
          {{ product.description }}
        </p>
      </div>

      {% if product.warranty_period %}
      <div
        style="
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 1.5rem;
          color: var(--success);
        "
      >
        <i class="fas fa-shield-alt"></i>
        <span>{{ product.warranty_period }} Warranty</span>
      </div>
      {% endif %}

      <div style="display: flex; gap: 1rem; margin-bottom: 2rem">
        {% if user.is_authenticated %} {% if product.stock > 0 %}
        <a
          href="{% url 'add_to_cart' product.id %}"
          class="btn btn-primary btn-add-to-cart"
          style="
            flex: 1;
            justify-content: center;
            padding: 1rem;
            font-size: 1.1rem;
          "
        >
          <i class="fas fa-cart-plus"></i> Add to Cart
        </a>
        <a
          href="{% url 'add_to_wishlist' product.id %}"
          class="btn btn-outline"
          style="padding: 1rem"
        >
          <i class="fas fa-heart"></i>
        </a>
        {% else %}
        <button
          class="btn btn-danger"
          disabled
          style="flex: 1; padding: 1rem; font-size: 1.1rem"
        >
          <i class="fas fa-times-circle"></i> Out of Stock
        </button>
        {% endif %} {% else %}
        <a
          href="{% url 'login' %}"
          class="btn btn-primary"
          style="
            flex: 1;
            justify-content: center;
            padding: 1rem;
            font-size: 1.1rem;
          "
        >
          <i class="fas fa-sign-in-alt"></i> Login to Buy
        </a>
        {% endif %}
      </div>

      <div class="card glass">
        <h4 style="margin-bottom: 1rem">
          <i class="fas fa-truck"></i> Delivery & Services
        </h4>
        <ul
          style="list-style: none; color: var(--text-secondary); line-height: 2"
        >
          <li>
            <i
              class="fas fa-check"
              style="color: var(--success); margin-right: 0.5rem"
            ></i>
            Free delivery on orders above ₹500
          </li>
          <li>
            <i
              class="fas fa-check"
              style="color: var(--success); margin-right: 0.5rem"
            ></i>
            7-day return policy
          </li>
          <li>
            <i
              class="fas fa-check"
              style="color: var(--success); margin-right: 0.5rem"
            ></i>
            Secure payment options
          </li>
          <li>
            <i
              class="fas fa-check"
              style="color: var(--success); margin-right: 0.5rem"
            ></i>
            Cash on Delivery available
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Specifications -->
  {% if product.specifications.all %}
  <section style="margin-bottom: 4rem">
    <h2 style="margin-bottom: 2rem">
      <i class="fas fa-list-ul"></i> Technical Specifications
    </h2>
    <div class="card">
      <table style="width: 100%; border-collapse: collapse">
        {% for spec in product.specifications.all %}
        <tr style="border-bottom: 1px solid var(--border-color)">
          <td
            style="
              padding: 1rem;
              font-weight: 600;
              color: var(--text-secondary);
              width: 30%;
            "
          >
            {{ spec.name }}
          </td>
          <td style="padding: 1rem; color: var(--text-primary)">
            {{ spec.value }}
          </td>
        </tr>
        {% endfor %}
      </table>
    </div>
  </section>
  {% endif %}

  <!-- Reviews -->
  <section style="margin-bottom: 4rem">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      "
    >
      <h2>
        <i class="fas fa-star"></i> Customer Reviews ({{ reviews.count }})
      </h2>
      {% if can_review %}
      <a href="{% url 'add_review' product.id %}" class="btn btn-primary">
        <i class="fas fa-pen"></i> Write a Review
      </a>
      {% endif %}
    </div>

    {% for review in reviews %}
    <div class="card" style="margin-bottom: 1rem">
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: start;
          margin-bottom: 1rem;
        "
      >
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem">
            {{ review.user.username }}
          </div>
          <div style="display: flex; align-items: center; gap: 0.5rem">
            <div style="display: flex; gap: 0.25rem">
              {% for i in "12345" %}
              <i
                class="fas fa-star"
                style="color: {% if review.rating >= forloop.counter %}var(--warning){% else %}var(--text-muted){% endif %}; font-size: 0.9rem;"
              ></i>
              {% endfor %}
            </div>
            {% if review.is_verified_purchase %}
            <span class="badge badge-success" style="font-size: 0.7rem"
              >Verified Purchase</span
            >
            {% endif %}
          </div>
        </div>
        <span style="color: var(--text-muted); font-size: 0.9rem"
          >{{ review.created_at|date:"M d, Y" }}</span
        >
      </div>
      <h4 style="margin-bottom: 0.5rem">{{ review.title }}</h4>
      <p style="color: var(--text-secondary)">{{ review.comment }}</p>
    </div>
    {% empty %}
    <div class="card" style="text-align: center; padding: 3rem">
      <i
        class="fas fa-comment-slash"
        style="
          font-size: 3rem;
          color: var(--text-muted);
          opacity: 0.3;
          margin-bottom: 1rem;
        "
      ></i>
      <p style="color: var(--text-muted)">
        No reviews yet. Be the first to review this product!
      </p>
    </div>
    {% endfor %}
  </section>

  <!-- Related Products -->
  {% if related_products %}
  <section>
    <h2 style="margin-bottom: 2rem">
      <i class="fas fa-th"></i> Related Products
    </h2>
    <div class="grid grid-4">
      {% for product in related_products %}
      <div class="card product-card">
        <a href="{% url 'product_detail' product.slug %}">
          {% if product.images.all.0 %}
          <img
            src="{{ product.images.all.0.image.url }}"
            alt="{{ product.name }}"
          />
          {% else %}
          <div
            style="
              width: 100%;
              height: 250px;
              background: linear-gradient(
                135deg,
                var(--primary-color),
                var(--secondary-color)
              );
              border-radius: 0.75rem;
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-image"
              style="font-size: 3rem; color: white; opacity: 0.3"
            ></i>
          </div>
          {% endif %}
        </a>
        <a href="{% url 'product_detail' product.slug %}" class="product-title">
          {{ product.name|truncatewords:6 }}
        </a>
        <div class="product-price">₹{{ product.final_price }}</div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}
</div>

<style>
  .product-thumbnail.active {
    border-color: var(--primary-color) !important;
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
  }
</style>
{% endblock %}
